#!/bin/bash
# Like `tmux select-pane`, but sends a `<C-h/j/k/l>` keystroke if Vim is
# running in the current pane, or only one pane exists.
set -e

cmd="$(tmux display -p '#{pane_current_command}')"
echo $cmd >> ~/panedebug
cmd="$(basename "$cmd" | tr A-Z a-z)"
echo $cmd >> ~/panedebug
pane_count="$(printf %d $(tmux list-panes | wc -l))"
echo $pane_count >> ~/panedebug

if [[ "${cmd%m}" = "vi" || ($pane_count = 1) ]]; then
  direction="$(echo "${1#-}" | tr 'lLDUR' '\\hjkl')"
  echo direction >> ~/panedebug
  # forward the keystroke to Vim
  tmux send-keys "C-$direction"
  echo "to vim tmux send-keys C-$direction" >> ~/panedebug
else
  tmux select-pane "$@" 
  echo "tmux select-pane $@" >> ~/panedebug
fi
